{"version":3,"sources":["../../../../src/components/HomeClient.jsx"],"sourcesContent":["'use client';\r\n\r\nimport React, { useState, useEffect, useRef, useCallback, useLayoutEffect } from 'react';\r\nimport Link from 'next/link';\r\nimport { products } from '../data/products';\r\n// import '../pages/Home.css'; // Moved to layout.jsx\r\n\r\nconst HomeClient = () => {\r\n    const [displayProducts, setDisplayProducts] = useState([]);\r\n    const [showLoadPrevious, setShowLoadPrevious] = useState(false);\r\n\r\n    const masterListRef = useRef([]);\r\n    const visibleWindowRef = useRef({ start: 0, end: 0 });\r\n    const loadingRef = useRef(false);\r\n    const observerRef = useRef(null);\r\n    const loadingIndicatorRef = useRef(null);\r\n    const scrollPreserveRef = useRef({ isPrepending: false, previousHeight: 0 });\r\n\r\n    const BATCH_SIZE = 24;\r\n    const MAX_VISIBLE_ITEMS = 72;\r\n\r\n    const [hasMore, setHasMore] = useState(true);\r\n\r\n    const updateDisplay = () => {\r\n        const { start, end } = visibleWindowRef.current;\r\n        const slice = masterListRef.current.slice(start, end);\r\n        setDisplayProducts(slice);\r\n        setShowLoadPrevious(start > 0);\r\n        setHasMore(end < masterListRef.current.length);\r\n    };\r\n\r\n    useEffect(() => {\r\n        if (!products || !Array.isArray(products)) return;\r\n\r\n        // Shuffle once on init\r\n        const shuffled = [...products].sort(() => 0.5 - Math.random());\r\n\r\n        // Add unique key just in case, but maintain 1-to-1 mapping\r\n        const prepareProducts = shuffled.map(p => ({\r\n            ...p,\r\n            uniqueKey: `${p.id}-${Date.now()}-${Math.random()}`\r\n        }));\r\n\r\n        masterListRef.current = prepareProducts;\r\n\r\n        // Initial window\r\n        const initialCount = Math.min(BATCH_SIZE, prepareProducts.length);\r\n        visibleWindowRef.current = { start: 0, end: initialCount };\r\n        updateDisplay();\r\n    }, []);\r\n\r\n    useLayoutEffect(() => {\r\n        if (scrollPreserveRef.current.isPrepending) {\r\n            const newHeight = document.documentElement.scrollHeight;\r\n            const diff = newHeight - scrollPreserveRef.current.previousHeight;\r\n            window.scrollBy(0, diff);\r\n            scrollPreserveRef.current.isPrepending = false;\r\n        }\r\n    }, [displayProducts]);\r\n\r\n    const loadMore = useCallback(() => {\r\n        if (loadingRef.current) return;\r\n\r\n        const totalItems = masterListRef.current.length;\r\n        const { end } = visibleWindowRef.current;\r\n\r\n        // Stop if we've shown all products\r\n        if (end >= totalItems) return;\r\n\r\n        loadingRef.current = true;\r\n\r\n        setTimeout(() => {\r\n            try {\r\n                let { start, currentEnd } = visibleWindowRef.current;\r\n\r\n                // Just extend the window, don't create new items\r\n                let newEnd = end + BATCH_SIZE;\r\n                if (newEnd > totalItems) newEnd = totalItems;\r\n\r\n                if (newEnd - start > MAX_VISIBLE_ITEMS) {\r\n                    start = newEnd - MAX_VISIBLE_ITEMS;\r\n                }\r\n\r\n                visibleWindowRef.current = { start, end: newEnd };\r\n                updateDisplay();\r\n            } catch (error) {\r\n                console.error(\"Error loading more products:\", error);\r\n            } finally {\r\n                loadingRef.current = false;\r\n            }\r\n        }, 500);\r\n    }, []);\r\n\r\n    const loadPrevious = () => {\r\n        scrollPreserveRef.current = {\r\n            isPrepending: true,\r\n            previousHeight: document.documentElement.scrollHeight\r\n        };\r\n\r\n        let { start, end } = visibleWindowRef.current;\r\n        const newStart = Math.max(0, start - BATCH_SIZE);\r\n\r\n        visibleWindowRef.current = { start: newStart, end };\r\n        updateDisplay();\r\n    };\r\n\r\n    useEffect(() => {\r\n        const options = {\r\n            root: null,\r\n            rootMargin: '100px',\r\n            threshold: 0.1\r\n        };\r\n\r\n        observerRef.current = new IntersectionObserver((entries) => {\r\n            const first = entries[0];\r\n            if (first.isIntersecting && hasMore) { // Only load more if hasMore is true\r\n                loadMore();\r\n            }\r\n        }, options);\r\n\r\n        if (loadingIndicatorRef.current && hasMore) { // Only observe if there's more to load\r\n            observerRef.current.observe(loadingIndicatorRef.current);\r\n        }\r\n\r\n        return () => {\r\n            if (observerRef.current) {\r\n                observerRef.current.disconnect();\r\n            }\r\n        };\r\n    }, [loadMore, hasMore]); // Add hasMore dependency to re-observe if it reappears\r\n\r\n    const mainCategories = [\r\n        { id: 'men', name: 'Men', image: 'https://i.postimg.cc/prXDrB2s/premium-grey-hoodie-atsu-wolf.webp', link: '/shop/Men' },\r\n        { id: 'women', name: 'Women', image: 'https://i.postimg.cc/g2YnW02T/Ghost-of-Yotei-Pink-Hoodie.webp', link: '/shop/Women' },\r\n        { id: 'kids', name: 'Kids', image: 'https://i.postimg.cc/prXDrB2s/premium-grey-hoodie-atsu-wolf.webp', link: '/shop/Kids' },\r\n        { id: 'hoodies', name: 'Hoodies', image: 'https://i.postimg.cc/g2YnW02T/Ghost-of-Yotei-Pink-Hoodie.webp', link: '/shop/Hoodies' },\r\n        { id: 'jackets', name: 'Jackets', image: 'https://i.postimg.cc/prXDrB2s/premium-grey-hoodie-atsu-wolf.webp', link: '/shop/Jackets' }\r\n    ];\r\n\r\n    const gamingCollections = [\r\n        { id: 'ghost-of-yotei', name: 'Ghost of Yotei', image: 'https://i.postimg.cc/prXDrB2s/premium-grey-hoodie-atsu-wolf.webp', link: '/shop/Gaming%20Outfits/Ghost%20of%20Yotei' }\r\n    ];\r\n\r\n    if (!products || !Array.isArray(products)) {\r\n        return <div className=\"container\" style={{ padding: '100px 0', textAlign: 'center' }}>Error loading products.</div>;\r\n    }\r\n\r\n    return (\r\n        <div className=\"home-page\">\r\n            {/* Hero Section Restored */}\r\n            <section className=\"hero\">\r\n                <div className=\"hero-content fade-in-up\">\r\n                    <h1 className=\"h1 hero-title\">Wear Without Fear</h1>\r\n                    <p className=\"hero-subtitle\">Pakistan's premier fashion destination. Authentic style, tailored for you.</p>\r\n                    <div className=\"hero-actions\">\r\n                        <Link href=\"/collections\" className=\"btn btn-primary\">Shop Collection</Link>\r\n                        <button className=\"btn btn-outline\">View Lookbook</button>\r\n                    </div>\r\n                </div>\r\n            </section>\r\n\r\n            {/* Featured Products Section */}\r\n            <section className=\"section container\" style={{ marginTop: '4rem' }}>\r\n                <div className=\"section-header text-center mb-10\">\r\n                    <h2 className=\"h2 section-title\">Featured Products</h2>\r\n                    <div className=\"section-divider mx-auto\"></div>\r\n                    <p className=\"section-subtitle text-muted\">Premium quality, designed for the bold.</p>\r\n                </div>\r\n\r\n                {showLoadPrevious && (\r\n                    <div className=\"text-center mb-8\">\r\n                        <button onClick={loadPrevious} className=\"btn btn-outline load-prev-btn\">\r\n                            Load Previous Products\r\n                        </button>\r\n                    </div>\r\n                )}\r\n\r\n                <div className=\"product-grid\">\r\n                    {displayProducts.map((product) => (\r\n                        <div key={product.uniqueKey} className=\"product-card fade-in\">\r\n                            <Link href={`/product/${product.slug}`} className=\"product-image-wrapper\">\r\n                                <img src={product.image} alt={product.name} className=\"product-image\" />\r\n                                <div className=\"product-overlay\">\r\n                                    <button className=\"btn btn-secondary quick-view-btn\">View Details</button>\r\n                                </div>\r\n                            </Link>\r\n                            <div className=\"product-info\">\r\n                                <span style={{ fontSize: '0.75rem', color: 'var(--color-text-light)', fontWeight: '500', marginBottom: '4px', display: 'block' }}>\r\n                                    ID: {product.id}\r\n                                </span>\r\n                                <Link href={`/product/${product.slug}`} className=\"product-title\">{product.name}</Link>\r\n                                <div className=\"product-meta\">\r\n                                    <span className=\"product-price\">PKR {product.price.toLocaleString()}</span>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n\r\n                {hasMore && (\r\n                    <div className=\"loading-indicator\" ref={loadingIndicatorRef}>\r\n                        <div className=\"spinner\"></div>\r\n                        <p>Loading products...</p>\r\n                    </div>\r\n                )}\r\n            </section>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default HomeClient;\r\n"],"names":[],"mappings":"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"}